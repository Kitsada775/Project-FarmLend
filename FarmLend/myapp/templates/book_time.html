{% extends 'base.html' %}

{% block title %}‡∏à‡∏≠‡∏á‡∏£‡∏ñ{% endblock %}

{% block content %}
<div class="flex justify-center min-h-screen bg-gradient-to-b from-blue-50 to-gray-100 p-4 md:p-6">
    <div class="max-w-3xl w-full bg-white shadow-xl rounded-xl p-6 md:p-8 transition-all duration-300 transform hover:shadow-2xl">
        
        <h2 class="text-3xl font-extrabold text-gray-800 text-center mb-6">üöó ‡∏à‡∏≠‡∏á‡∏£‡∏ñ {{ car.name }}</h2>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
            <h3 class="text-lg font-semibold text-gray-800">üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ</h3>
            <ul class="mt-2 text-gray-700">
                <li><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ:</strong> {{ car.name }}</li>
                <li><strong>‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤:</strong> {{ car.horsepower }} HP</li>
                <li><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> {{ car.description }}</li>
            </ul>
        </div>
        
        <form method="post" action="{% url 'create_booking' car.id %}" class="space-y-6">
            {% csrf_token %}

            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
            <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                <label for="date" class="block text-gray-700 font-medium mb-2">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                <input type="date" id="date" name="date" required 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
            </div>

            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ -->
            <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                <label class="block text-gray-700 font-medium mb-2">üïí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</label>
                <select name="time_type" id="time_type" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    <option value="">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á</option>
                    <option value="morning">‚òÄÔ∏è ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ä‡πâ‡∏≤ (08:00 - 12:00)</option>
                    <option value="afternoon">üåá ‡∏ä‡πà‡∏ß‡∏á‡∏ö‡πà‡∏≤‡∏¢ (13:00 - 17:00)</option>
                </select>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤ - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ -->
            <div id="priceInfoSection" class="hidden bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                <h3 class="text-lg font-semibold mb-3 text-gray-800">üí∞ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <p class="text-sm text-gray-600">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</p>
                        <p id="selectedTimeInfo" class="font-medium text-gray-800"></p>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ä‡πà‡∏≤:</p>
                            <p id="rentalPrice" class="font-medium text-gray-800"></p>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏£‡πà:</p>
                            <p id="pricePerRai" class="font-medium text-gray-800">{{ car.price_per_rai }} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏£‡πà:</p>
                            <p id="timePerRai" class="font-medium text-gray-800">{{ car.time_per_rai }} ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
            <div id="customTimeSection" class="bg-gray-50 rounded-lg p-4 border-l-4 border-gray-500">
                <h3 class="text-lg font-semibold mb-3 text-gray-800">‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h3>
                
                <p class="text-sm text-gray-600 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ):</p>
                
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2">
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="08:00" data-end="09:00">
                        <span class="ml-3 text-gray-700 text-sm">08:00 - 09:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="09:00" data-end="10:00">
                        <span class="ml-3 text-gray-700 text-sm">09:00 - 10:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="10:00" data-end="11:00">
                        <span class="ml-3 text-gray-700 text-sm">10:00 - 11:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="11:00" data-end="12:00">
                        <span class="ml-3 text-gray-700 text-sm">11:00 - 12:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="12:00" data-end="13:00">
                        <span class="ml-3 text-gray-700 text-sm">12:00 - 13:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="13:00" data-end="14:00">
                        <span class="ml-3 text-gray-700 text-sm">13:00 - 14:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="14:00" data-end="15:00">
                        <span class="ml-3 text-gray-700 text-sm">14:00 - 15:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="15:00" data-end="16:00">
                        <span class="ml-3 text-gray-700 text-sm">15:00 - 16:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="16:00" data-end="17:00">
                        <span class="ml-3 text-gray-700 text-sm">16:00 - 17:00</span>
                    </label>
                    
                    <label class="relative flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-all">
                        <input type="checkbox" name="time_slot" class="time-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" 
                            data-start="17:00" data-end="18:00">
                        <span class="ml-3 text-gray-700 text-sm">17:00 - 18:00</span>
                    </label>
                </div>
                
                <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100 hidden" id="customTimeSummary">
                    <div class="flex items-center">
                        <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        <p class="ml-3 text-sm text-blue-800">
                            ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ <span id="customTimeText" class="font-medium"></span>
                            <span class="ml-2 text-xs">(‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ <span id="durationText">0</span> ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</span>
                        </p>
                    </div>
                </div>
                
                <!-- ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á -->
                <div class="mt-4 p-3 bg-red-50 rounded-lg border border-red-100 hidden" id="timeWarning">
                    <div class="flex items-center">
                        <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-red-100 text-red-600 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        <p class="ml-3 text-sm text-red-800" id="timeWarningText">
                            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏ß‡∏á
                        </p>
                    </div>
                </div>
                
                <!-- Hidden inputs -->
                <input type="hidden" name="start_time" id="start_time">
                <input type="hidden" name="end_time" id="end_time">
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô -->
            <button type="submit" id="submitBtn"
                class="w-full px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all disabled:opacity-70 disabled:cursor-not-allowed"
                disabled>
                ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
            </button>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const timeTypeSelect = document.getElementById("time_type");
    const customTimeSection = document.getElementById("customTimeSection");
    const priceInfoSection = document.getElementById("priceInfoSection");
    const timeCheckboxes = document.querySelectorAll(".time-checkbox");
    const startTimeInput = document.getElementById("start_time");
    const endTimeInput = document.getElementById("end_time");
    const customTimeSummary = document.getElementById("customTimeSummary");
    const customTimeText = document.getElementById("customTimeText");
    const durationText = document.getElementById("durationText");
    const timeWarning = document.getElementById("timeWarning");
    const timeWarningText = document.getElementById("timeWarningText");
    const selectedTimeInfo = document.getElementById("selectedTimeInfo");
    const rentalPrice = document.getElementById("rentalPrice");
    const pricePerRai = document.getElementById("pricePerRai");
    const timePerRai = document.getElementById("timePerRai");
    const submitBtn = document.getElementById("submitBtn");

    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Django ‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô HTML
    const morningPrice = "{{ car.morning_price }}";
    const afternoonPrice = "{{ car.afternoon_price|default:car.morning_price }}";
    const pricePerRaiValue = parseInt("{{ car.price_per_rai }}");
    const timePerRaiValue = parseInt("{{ car.time_per_rai }}");
    const contactOwner = {% if car.contact_owner %}true{% else %}false{% endif %};

    // ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á
    const priceData = {
        morning: {
            rental: contactOwner ? "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ" : parseInt(morningPrice),
            perRai: pricePerRaiValue,
            timePerRai: timePerRaiValue
        },
        afternoon: {
            rental: contactOwner ? "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ" : parseInt(afternoonPrice),
            perRai: pricePerRaiValue,
            timePerRai: timePerRaiValue
        },
        custom: {
            rentalPerHour: contactOwner ? null : Math.ceil(parseInt(morningPrice) / 4),
            perRai: pricePerRaiValue,
            timePerRai: timePerRaiValue
        }
    };

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ß‡∏•‡∏≤
    timeTypeSelect.addEventListener("change", function() {
        if (this.value === "") {
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á
            customTimeSection.classList.remove("hidden");
            priceInfoSection.classList.add("hidden");
            clearAllCheckboxes();
            validateTimeSelection();
        } else {
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ
            customTimeSection.classList.add("hidden");
            
            if (this.value === "morning") {
                startTimeInput.value = "08:00";
                endTimeInput.value = "12:00";
                updatePriceInfo("morning", "08:00 - 12:00");
            } else if (this.value === "afternoon") {
                startTimeInput.value = "13:00";
                endTimeInput.value = "17:00";
                updatePriceInfo("afternoon", "13:00 - 17:00");
            }
            
            priceInfoSection.classList.remove("hidden");
            submitBtn.disabled = false;
        }
    });

    function clearAllCheckboxes() {
        timeCheckboxes.forEach(cb => cb.checked = false);
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
    timeCheckboxes.forEach(checkbox => {
        checkbox.addEventListener("change", function() {
            validateTimeSelection();
        });
    });

    function validateTimeSelection() {
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        let selectedTimes = Array.from(timeCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => ({
                start: cb.getAttribute("data-start"),
                end: cb.getAttribute("data-end")
            }))
            .sort((a, b) => a.start.localeCompare(b.start));
        
        if (selectedTimes.length === 0) {
            timeWarningText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏ß‡∏á";
            timeWarning.classList.remove("hidden");
            customTimeSummary.classList.add("hidden");
            submitBtn.disabled = true;
            return;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        let isConsecutive = true;
        let gaps = [];
        
        for (let i = 0; i < selectedTimes.length - 1; i++) {
            if (selectedTimes[i].end !== selectedTimes[i + 1].start) {
                isConsecutive = false;
                gaps.push(`${selectedTimes[i].end} - ${selectedTimes[i + 1].start}`);
            }
        }
        
        if (!isConsecutive) {
            timeWarningText.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏±‡∏ô";
            timeWarning.classList.remove("hidden");
            customTimeSummary.classList.add("hidden");
            submitBtn.disabled = true;
            return;
        }
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
        startTimeInput.value = selectedTimes[0].start;
        endTimeInput.value = selectedTimes[selectedTimes.length - 1].end;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
        const hours = selectedTimes.length;
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        timeWarning.classList.add("hidden");
        customTimeText.textContent = `${startTimeInput.value} - ${endTimeInput.value}`;
        durationText.textContent = hours;
        customTimeSummary.classList.remove("hidden");
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤
        updatePriceInfo("custom", `${startTimeInput.value} - ${endTimeInput.value}`, hours);
        
        submitBtn.disabled = false;
    }
    
    function updatePriceInfo(timeType, timeRangeText, hours = 4) {
    selectedTimeInfo.textContent = timeRangeText;
    
    if (timeType === "custom") {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏£‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°
        rentalPrice.textContent = `${priceData.custom.perRai} ‡∏ö‡∏≤‡∏ó`;
        pricePerRai.textContent = `${priceData.custom.perRai} ‡∏ö‡∏≤‡∏ó`;  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏£‡πà
        timePerRai.textContent = `${priceData.custom.timePerRai} ‡∏ô‡∏≤‡∏ó‡∏µ`;
    } else {
        if (contactOwner) {
            rentalPrice.textContent = "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ";
        } else {
            rentalPrice.textContent = `${priceData[timeType].rental} ‡∏ö‡∏≤‡∏ó`;  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ß‡∏•‡∏≤
        }
        pricePerRai.textContent = `${priceData[timeType].perRai} ‡∏ö‡∏≤‡∏ó`;  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏£‡πà
        timePerRai.textContent = `${priceData[timeType].timePerRai} ‡∏ô‡∏≤‡∏ó‡∏µ`;
    }
    
    priceInfoSection.classList.remove("hidden");
}


    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    if (timeTypeSelect.value === "") {
        customTimeSection.classList.remove("hidden");
    } else {
        customTimeSection.classList.add("hidden");
        
        if (timeTypeSelect.value === "morning") {
            updatePriceInfo("morning", "08:00 - 12:00");
            priceInfoSection.classList.remove("hidden");
            submitBtn.disabled = false;
        } else if (timeTypeSelect.value === "afternoon") {
            updatePriceInfo("afternoon", "13:00 - 17:00");
            priceInfoSection.classList.remove("hidden");
            submitBtn.disabled = false;
        }
    }
});
</script>

{% endblock %}
