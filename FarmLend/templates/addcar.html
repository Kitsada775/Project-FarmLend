{% extends 'base.html' %}

{% block title %}เพิ่มรถใหม่{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg mt-10">
    <h2 class="text-3xl font-bold mb-8 text-gray-800 text-center">เพิ่มรถใหม่</h2>

    <!-- การแสดงข้อผิดพลาด -->
    {% if form.errors %}
        <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-lg">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                <strong>กรุณาตรวจสอบข้อมูลที่กรอก!</strong>
            </div>
            <ul class="mt-3 list-disc list-inside space-y-1">
                {% for field in form %}
                    {% if field.errors %}
                        <li class="text-sm">
                            <span class="font-medium">{{ field.label }}:</span> 
                            {{ field.errors|join:", " }}
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <form action="{% url 'addcar' type_id=car_type.id %}" method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <div class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">ชื่อรถ</label>
            {{ form.name }}
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">คำอธิบาย</label>
            {{ form.description }}
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">แรงม้า</label>
            {{ form.horsepower }}
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">รูปภาพ</label>
            {{ form.image }}
        </div>

        <!-- ฟิลด์สำหรับราคาเหมาช่วงเช้าและช่วงบ่าย -->
        <div id="morning_price_fields" class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">ช่วงเช้า</label>
            <select name="morning_pricing_type" class="block w-full mt-1">
                <option value="flat">ราคาเหมา</option>
                <option value="contact">ติดต่อเจ้าของรถ</option>
            </select>
            <div id="morning_flat_price" class="mt-2">
                <label class="block text-gray-700 font-bold mb-2">ราคาเหมา (ช่วงเช้า)</label>
                {{ form.morning_price }}
            </div>
            <div id="morning_contact_price" class="mt-2 hidden">
                <label class="block text-gray-700 font-bold mb-2">ติดต่อผู้ใช้งาน (ช่วงเช้า)</label>
                <p>กรุณาติดต่อเจ้าของรถเพื่อสอบถามราคา</p>
            </div>
        </div>

        <div id="afternoon_price_fields" class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">ช่วงบ่าย</label>
            <select name="afternoon_pricing_type" class="block w-full mt-1">
                <option value="flat">ราคาเหมา</option>
                <option value="contact">ติดต่อเจ้าของรถ</option>
            </select>
            <div id="afternoon_flat_price" class="mt-2">
                <label class="block text-gray-700 font-bold mb-2">ราคาเหมา (ช่วงบ่าย)</label>
                {{ form.afternoon_price }}
            </div>
            <div id="afternoon_contact_price" class="mt-2 hidden">
                <label class="block text-gray-700 font-bold mb-2">ติดต่อผู้ใช้งาน (ช่วงบ่าย)</label>
                <p>กรุณาติดต่อเจ้าของรถเพื่อสอบถามราคา</p>
            </div>
        </div>

        <!-- ฟิลด์สำหรับราคาต่อไร่ -->
        <div id="per_rai_fields" class="mb-4">
            <label class="block text-gray-700 font-bold mb-2">ราคาต่อไร่</label>
            {{ form.price_per_rai }}

            <label class="block text-gray-700 font-bold mt-4 mb-2">เวลาทำงานต่อไร่ (นาที)</label>
            {{ form.time_per_rai }}
        </div>

        <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
            บันทึกข้อมูลรถ
        </button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let morningPricingTypeField = document.querySelector("select[name='morning_pricing_type']");
        let morningFlatPriceField = document.getElementById('morning_flat_price');
        let morningContactPriceField = document.getElementById('morning_contact_price');

        let afternoonPricingTypeField = document.querySelector("select[name='afternoon_pricing_type']");
        let afternoonFlatPriceField = document.getElementById('afternoon_flat_price');
        let afternoonContactPriceField = document.getElementById('afternoon_contact_price');

        function toggleMorningPricingFields() {
            if (morningPricingTypeField.value === 'flat') {
                morningFlatPriceField.classList.remove('hidden');
                morningContactPriceField.classList.add('hidden');
            } else {
                morningFlatPriceField.classList.add('hidden');
                morningContactPriceField.classList.remove('hidden');
            }
        }

        function toggleAfternoonPricingFields() {
            if (afternoonPricingTypeField.value === 'flat') {
                afternoonFlatPriceField.classList.remove('hidden');
                afternoonContactPriceField.classList.add('hidden');
            } else {
                afternoonFlatPriceField.classList.add('hidden');
                afternoonContactPriceField.classList.remove('hidden');
            }
        }

        morningPricingTypeField.addEventListener('change', toggleMorningPricingFields);
        afternoonPricingTypeField.addEventListener('change', toggleAfternoonPricingFields);

        toggleMorningPricingFields();
        toggleAfternoonPricingFields();
    });
</script>
{% endblock %}