<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Detail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö body ‡πÅ‡∏•‡∏∞ container */
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 20px;
        }

        .car-image {
            display: block;
            max-width: 100%;
            height: auto;
            margin: 20px auto;
            border-radius: 8px;
        }

        .description {
            font-size: 1.1rem;
            line-height: 1.5;
            color: #555;
            margin-bottom: 20px;
        }

        .button-container {
            margin-top: 20px;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å */
        .main-button {
            padding: 12px 25px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.3s ease;
        }

        .main-button:hover {
            background-color: #0056b3;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö */
        .btn-secondary {
            display: inline-block;
            width: 200px;
            margin: 20px auto;
            padding: 10px;
            text-align: center;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        /* Modal */
        .modal {
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô modal ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5); /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î */
            padding-top: 60px;
            text-align: center; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Modal */
        .hidden-buttons button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .hidden-buttons button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>{{ car.name }}</h1>
        <img src="{{ car.image.url }}" alt="{{ car.name }}" class="car-image">
        <p class="description">{{ car.description }}</p>
        <p>‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤: {{ car.horsepower }} ‡πÅ‡∏£‡∏á‡∏°‡πâ‡∏≤</p>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ -->
        <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
            {% if car.is_available %}
                <span class="text-green-500">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
            {% else %}
                <span class="text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
            {% endif %}
        </p>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ -->
        <div class="owner-info">
            <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ</h3>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á:</strong> {{ car.owner.first_name }} {{ car.owner.last_name }}</p>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô:</strong> {{ car.owner.nickname }}</p>
            <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> {{ car.owner.phone_number }}</p>
            <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> {{ car.owner.address }}</p>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡∏ñ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        <div class="button-container">
            <a href="{% url 'car_review' car.id %}" class="main-button">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡∏ñ‡∏ô‡∏µ‡πâ</a>
        </div>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        {% if car.owner == request.user or request.user.is_staff %}
            <form action="{% url 'toggle_car_status' car.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning">
                    {% if car.is_available %}
                        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    {% else %}
                        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    {% endif %}
                </button>
            </form>
        {% endif %}
        
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å -->
        <div class="button-container">
            <a href="{% url 'car_list_by_type' car.car_type.id %}" class="btn-secondary">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</a>
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
            {% if car.is_available %}
                <button class="main-button" onclick="openModal()">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</button>
            {% endif %}
        </div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ä‡∏ó -->
<div class="button-container mt-4">
    {% if user.is_authenticated %}
        {% if user != car.owner %}  <!-- Only show chat button if user is not the car owner -->
            <a href="{% url 'create_chat_room' car.id %}" class="main-button">
                üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ
            </a>
        {% endif %}
    {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}" class="main-button">
            üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏ó
        </a>
    {% endif %}
</div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô -->
        {% if car.owner == request.user or request.user.is_staff %}
            <a href="{% url 'edicar' car.id car.car_type.id %}" class="btn btn-warning">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏ñ</a>
            <form action="{% url 'delcar' car.id car.car_type.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" onclick="return confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">‡∏•‡∏ö‡∏£‡∏ñ</button>
            </form>
        {% endif %}
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content p-6 bg-white rounded-lg shadow-lg">
            <span class="close cursor-pointer text-gray-500 hover:text-gray-800" onclick="closeModal()">&times;</span>
            <h2 class="text-xl font-semibold mb-4 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>

            <!-- Date Picker -->
            <div class="mb-4">
                <label for="date" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="date" id="date" name="date" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ -->
            <div class="flex justify-around mt-4">
                <button id="morningBtn" class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ä‡πâ‡∏≤
                </button>
                <button id="afternoonBtn" class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    ‡∏ä‡πà‡∏ß‡∏á‡∏ö‡πà‡∏≤‡∏¢
                </button>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
        document.getElementById('morningBtn').addEventListener('click', function () {
            handleTimeSelection('morning');
        });
        document.getElementById('afternoonBtn').addEventListener('click', function () {
            handleTimeSelection('afternoon');
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤
        function handleTimeSelection(time) {
            const selectedDate = document.getElementById('date').value;
            const carId = "{{ car.id }}"; // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ car_id ‡∏à‡∏≤‡∏Å Django template

            if (!selectedDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô URL
            window.location.href = `/confirm_selection/?date=${selectedDate}&time=${time}&car_id=${carId}`;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal
        function openModal() {
            document.getElementById("myModal").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á Modal
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î Modal
        function closeModal() {
            document.getElementById("myModal").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô Modal
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal ‡∏Å‡πá‡∏õ‡∏¥‡∏î‡∏°‡∏±‡∏ô
        window.onclick = function (event) {
            if (event.target == document.getElementById("myModal")) {
                closeModal();
            }
        }
    </script>
</body>
</html>
