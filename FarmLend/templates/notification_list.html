<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>การแจ้งเตือน</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6">
        <h1 class="text-2xl font-semibold mb-4">การแจ้งเตือนของคุณ</h1>

        <ul>
            {% for notification in notifications %}
                <li class="bg-white p-4 rounded shadow-md mb-4">
                    <p>{{ notification.message }}</p>
                    <span class="text-gray-500 text-sm">{{ notification.timestamp }}</span>

                    {% if notification.schedule %}
                        {% if not notification.is_confirmed %}
                            <!-- ถ้าการแจ้งเตือนยังไม่ได้รับการยืนยัน -->
                            <form method="POST" action="{% url 'confirm_reservation' reservation_id=notification.schedule.id %}" class="mt-3" id="reservation-form-{{ notification.schedule.id }}">
                                {% csrf_token %}
                                <button type="button" onclick="confirmAction('{{ notification.schedule.id }}', 'approve')" class="bg-green-500 text-white px-4 py-2 rounded mr-2" id="approve-btn-{{ notification.schedule.id }}">ยืนยัน</button>
                                <button type="button" onclick="confirmAction('{{ notification.schedule.id }}', 'reject')" class="bg-red-500 text-white px-4 py-2 rounded" id="reject-btn-{{ notification.schedule.id }}">ปฏิเสธ</button>
                            </form>
                        {% else %}
                            <!-- ถ้าได้รับการยืนยันแล้ว -->
                            <p class="text-green-500 text-sm mt-2">
                                {% if notification.is_approved %}
                                    การจองได้รับการยืนยันแล้ว
                                {% else %}
                            <p class="text-red-500 text-sm mt-2">
                                    เจ้าของรถปฏิเสธการจอง
                                {% endif %}
                            </p>
                        {% endif %}
                    {% else %}
                        <p class="text-gray-500 text-sm mt-2">ข้อมูลการจองไม่ถูกต้อง</p>
                    {% endif %}
                </li>
            {% empty %}
                <li class="text-center text-gray-500">ไม่มีการแจ้งเตือนในขณะนี้</li>
            {% endfor %}
        </ul>
    </div>

    <script>
        // ฟังก์ชันสำหรับยืนยันหรือปฏิเสธ
        function confirmAction(reservationId, action) {
            // ซ่อนปุ่มหลังจากกด
            document.getElementById(`approve-btn-${reservationId}`).style.display = 'none';
            document.getElementById(`reject-btn-${reservationId}`).style.display = 'none';
            
            // เปลี่ยนข้อความหลังจากกดปุ่ม
            var message = action === 'approve' ? 'การจองได้รับการยืนยันแล้ว' : 'เจ้าของรถปฏิเสธการจอง';
            var statusElement = document.createElement('p');
            statusElement.classList.add('text-green-500', 'text-sm', 'mt-2');
            statusElement.textContent = message;
    
            // เพิ่มข้อความใหม่ลงใน li
            var listItem = document.querySelector(`#reservation-form-${reservationId}`).closest('li');
            listItem.appendChild(statusElement);
    
            // ส่งข้อมูลไปยัง server
            var form = document.getElementById(`reservation-form-${reservationId}`);
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'action';
            input.value = action;
            form.appendChild(input);
    
            // ส่ง form
            form.submit();
        }
    </script>
    
</body>
</html>
